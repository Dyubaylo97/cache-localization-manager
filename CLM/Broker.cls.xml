<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="CLM.Broker">
<Super>CLM.AbstractBroker,CLM.Common</Super>
<TimeCreated>63714,58855.014604</TimeCreated>

<XData name="UrlMap">
<Data><![CDATA[
<Routes>
	<Route Url="/messages" Method="GET" Call="GetMessages"/>
	<Route Url="/messages" Method="PUT" Call="PutMessage"/>
	<Route Url="/messages" Method="POST" Call="PostMessage"/>
	<Route Url="/test" Method="GET" Call="Test"/>
	<Route Url="/add-new-localization" Method="POST" Call="AddNewLocalization"/>
	<Route Url="/export/:domain" Method="GET" Call="DownloadDomain"/>
</Routes>
]]></Data>
</XData>

<Method name="Test">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	w "test"
	q $$$OK
]]></Implementation>
</Method>

<Method name="GetMessages">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set %response.ContentType = "application/json"
	
	set domain = %request.Data("domain", 1)
	set language = %request.Data("language", 1)
	set spellcheck = %request.Data("spellcheck", 1)
	if (spellcheck = "true") {
		return ##class(CLM.Utils).CheckMessages(domain, language, $$$MessageDictionaryGlobal)
	} else {
		return ##class(CLM.Utils).GetMessageList(domain, language, $$$MessageDictionaryGlobal)
	}
]]></Implementation>
</Method>

<Method name="PutMessage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set domain = %request.Data("domain", 1)
	set language = %request.Data("language", 1)
	set id = %request.Data("id", 1)
	set text = %request.Data("text", 1)
	return ##class(CLM.Utils).PutMessage(domain, language, id, text, $$$MessageDictionaryGlobal)
]]></Implementation>
</Method>

<Method name="PostMessage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set domain = $$$R("Domain") 
	set messages = $$$R("Messages")
	return ##class(CLM.Utils).PostMessages(domain, messages, $$$MessageDictionaryGlobal)
]]></Implementation>
</Method>

<Method name="AddNewLocalization">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set domain = %request.Data("domain", 1)
	set from = %request.Data("from", 1)
	set to = %request.Data("to", 1)
	
	return ##class(CLM.Utils).AddNewLocalization($EXTRACT(from, 1, 2), to, domain)
]]></Implementation>
</Method>

<Method name="DownloadDomain">
<ClassMethod>1</ClassMethod>
<FormalSpec>domain:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#dim %request As %CSP.Request
	set oid = ##class(%CSP.StreamServer).GetOidForFile("")
	set encoid = ..Encrypt(oid)
	do %request.Set("STREAMOID",encoid)
    if ##class(%CSP.StreamServer).OnPreHTTP() {
        set %response.Headers("Content-Disposition")="attachment; filename*=UTF-8''"_..EscapeURL("COSQuickRef.md","UTF8")
    }
	return ##class(%CSP.StreamServer).OnPage()
]]></Implementation>
</Method>
</Class>
</Export>
